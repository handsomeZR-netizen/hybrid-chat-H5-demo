# Hybrid Chat Application

æ··åˆèŠå¤©åº”ç”¨ - ç»“åˆ H5/Web æŠ€æœ¯ä¸åŸç”Ÿ Android èƒ½åŠ›çš„å®æ—¶é€šä¿¡ç³»ç»Ÿã€‚

## ğŸš€ é¡¹ç›®äº®ç‚¹

- ğŸ’¬ **å®æ—¶ç¾¤èŠ** - åŸºäº WebSocket çš„å¤šäººå®æ—¶é€šä¿¡
- ğŸ“± **è·¨å¹³å°** - Web + Android æ··åˆå¼€å‘æ¶æ„
- ğŸ¨ **ç°ä»£ UI** - React + TypeScript æ„å»ºçš„å“åº”å¼ç•Œé¢
- ğŸ“¦ **å¤šåª’ä½“æ”¯æŒ** - å›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘æ¶ˆæ¯å‘é€
- ğŸ”„ **æ‡’åŠ è½½** - æ™ºèƒ½å†å²æ¶ˆæ¯åŠ è½½
- ğŸ’¾ **åŒå­˜å‚¨æ¨¡å¼** - æœ¬åœ°æ–‡ä»¶å­˜å‚¨ / Supabase äº‘å­˜å‚¨
- ğŸ”Œ **JSBridge** - Web ä¸åŸç”Ÿ Android èƒ½åŠ›äº’é€š

## é¡¹ç›®ç»„æˆ

- **Node.js WebSocket æœåŠ¡å™¨** - å®æ—¶æ¶ˆæ¯æœåŠ¡å™¨
- **React Web å‰ç«¯** - èŠå¤©ç•Œé¢ï¼ˆTypeScript + Viteï¼‰
- **Android WebView åº”ç”¨** - åŸç”Ÿå®¹å™¨ä¸ JSBridge

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- âœ… **å®æ—¶é€šä¿¡** - WebSocket è¿æ¥ç®¡ç†ä¸æ¶ˆæ¯å¹¿æ’­
- âœ… **å¤šäººç¾¤èŠ** - æ”¯æŒå¤šç”¨æˆ·åŒæ—¶åœ¨çº¿èŠå¤©
- âœ… **ç”¨æˆ·ä¼šè¯ç®¡ç†** - ç”¨æˆ· ID åˆ° WebSocket çš„æ˜ å°„
- âœ… **åœ¨çº¿çŠ¶æ€** - ç”¨æˆ·åŠ å…¥/ç¦»å¼€å®æ—¶é€šçŸ¥
- âœ… **è¿æ¥ç®¡ç†** - è‡ªåŠ¨é‡è¿ã€å¿ƒè·³æ£€æµ‹ã€ä¼šè¯æ¸…ç†

### æ¶ˆæ¯åŠŸèƒ½
- âœ… **æ–‡æœ¬æ¶ˆæ¯** - æ”¯æŒæ–‡æœ¬èŠå¤©
- âœ… **å¤šåª’ä½“æ¶ˆæ¯** - å›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘å‘é€
- âœ… **ç³»ç»Ÿé€šçŸ¥** - ç”¨æˆ·åŠ å…¥/ç¦»å¼€æç¤º
- âœ… **æ¶ˆæ¯çŠ¶æ€** - å‘é€ä¸­ã€å·²å‘é€ã€å¤±è´¥çŠ¶æ€æ˜¾ç¤º
- âœ… **æ¶ˆæ¯é‡è¯•** - å¤±è´¥æ¶ˆæ¯å¯é‡æ–°å‘é€

### æ•°æ®ç®¡ç†
- âœ… **è‡ªåŠ¨åŠ è½½å†å²** - ç™»å½•åè‡ªåŠ¨åŠ è½½æœ€è¿‘ 50 æ¡èŠå¤©è®°å½•
- âœ… **å†å²è®°å½•æ‡’åŠ è½½** - æ»šåŠ¨åˆ°é¡¶éƒ¨è‡ªåŠ¨åŠ è½½æ›´æ—©çš„æ¶ˆæ¯
- âœ… **æŒä¹…åŒ–å­˜å‚¨** - æ”¯æŒæœ¬åœ°æ–‡ä»¶å­˜å‚¨æˆ– Supabase äº‘å­˜å‚¨
- âœ… **æ¶ˆæ¯è¿½æº¯** - å®Œæ•´çš„èŠå¤©è®°å½•ä¿å­˜ä¸æŸ¥è¯¢
- âœ… **å¤šè®¾å¤‡åŒæ­¥** - ä½¿ç”¨ Supabase å®ç°è·¨è®¾å¤‡æ¶ˆæ¯åŒæ­¥

### åŸç”Ÿèƒ½åŠ›ï¼ˆAndroidï¼‰
- âœ… **JSBridge** - Web ä¸ Android åŸç”Ÿé€šä¿¡
- âœ… **æ–‡ä»¶é€‰æ‹©** - è°ƒç”¨åŸç”Ÿæ–‡ä»¶é€‰æ‹©å™¨
- âœ… **æƒé™ç®¡ç†** - ç›¸æœºã€å­˜å‚¨ã€å½•éŸ³æƒé™å¤„ç†
- âœ… **è®¾å¤‡ä¿¡æ¯** - è·å–è®¾å¤‡å‹å·ç­‰ä¿¡æ¯

## é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ src/                    # Node.js æœåŠ¡å™¨
â”‚   â”œâ”€â”€ server.js           # æœåŠ¡å™¨å…¥å£
â”‚   â”œâ”€â”€ WebSocketServer.js  # WebSocket æœåŠ¡å™¨ä¸»ç±»
â”‚   â”œâ”€â”€ SessionManager.js   # ä¼šè¯ç®¡ç†å™¨
â”‚   â”œâ”€â”€ MessageHandler.js   # æ¶ˆæ¯å¤„ç†å™¨
â”‚   â”œâ”€â”€ StorageService.js   # æ–‡ä»¶å­˜å‚¨æœåŠ¡
â”‚   â””â”€â”€ SupabaseStorageService.js  # Supabase å­˜å‚¨æœåŠ¡
â”œâ”€â”€ supabase/               # Supabase é…ç½®
â”‚   â””â”€â”€ schema.sql          # æ•°æ®åº“è¡¨ç»“æ„
â”œâ”€â”€ client/                 # React Web å‰ç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/     # React ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ utils/          # WebSocket å·¥å…·
â”‚   â”‚   â””â”€â”€ test/           # å‰ç«¯æµ‹è¯•
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ android/                # Android WebView åº”ç”¨
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â””â”€â”€ src/main/java/com/hybridchat/app/
â”‚   â”‚       â”œâ”€â”€ MainActivity.java       # ä¸» Activity
â”‚   â”‚       â”œâ”€â”€ AndroidInterface.java   # JSBridge æ¥å£
â”‚   â”‚       â”œâ”€â”€ PermissionManager.java  # æƒé™ç®¡ç†
â”‚   â”‚       â””â”€â”€ FilePickerHelper.java   # æ–‡ä»¶é€‰æ‹©
â”‚   â””â”€â”€ README.md           # Android è¯¦ç»†æ–‡æ¡£
â”œâ”€â”€ __tests__/              # æœåŠ¡å™¨æµ‹è¯•
â””â”€â”€ .kiro/specs/            # åŠŸèƒ½è§„æ ¼æ–‡æ¡£
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### åç«¯
- Node.js + WebSocket (ws)
- Supabase (å¯é€‰äº‘å­˜å‚¨)
- Jest + fast-check (å±æ€§æµ‹è¯•)

### å‰ç«¯
- React 19 + TypeScript
- Vite (æ„å»ºå·¥å…·)
- Vitest (æµ‹è¯•æ¡†æ¶)

### ç§»åŠ¨ç«¯
- Android WebView
- Java (åŸç”Ÿä»£ç )
- JSBridge (Web-Native é€šä¿¡)

## ğŸ“¦ å®‰è£…ä¸è¿è¡Œ

### 1. å®‰è£…ä¾èµ–

```bash
# å®‰è£…æœåŠ¡ç«¯ä¾èµ–
npm install

# å®‰è£…å®¢æˆ·ç«¯ä¾èµ–
cd client
npm install
cd ..
```

### 2. é…ç½®å­˜å‚¨æ¨¡å¼

#### æ–¹å¼ A: ä½¿ç”¨æ–‡ä»¶å­˜å‚¨ï¼ˆé»˜è®¤ï¼Œæ— éœ€é…ç½®ï¼‰

ç›´æ¥å¯åŠ¨å³å¯ï¼Œæ¶ˆæ¯å°†ä¿å­˜åœ¨ `./data/messages.json`

#### æ–¹å¼ B: ä½¿ç”¨ Supabase äº‘å­˜å‚¨ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰

1. é˜…è¯»é…ç½®æŒ‡å—ï¼š[SUPABASE_SETUP.md](SUPABASE_SETUP.md)
2. åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
cp .env.example .env
```

3. ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```env
# å­˜å‚¨æ¨¡å¼ï¼šfile æˆ– supabase
STORAGE_MODE=supabase

# Supabase é…ç½®
SUPABASE_URL=https://your-project-id.supabase.co
SUPABASE_ANON_KEY=your-anon-key-here
```

### 3. å¯åŠ¨æœåŠ¡å™¨

```bash
npm start
```

æœåŠ¡å™¨å°†åœ¨ `http://localhost:8080` å¯åŠ¨ï¼ˆå¯é€šè¿‡ `PORT` ç¯å¢ƒå˜é‡ä¿®æ”¹ï¼‰ã€‚

### 4. å¯åŠ¨ Web å‰ç«¯

```bash
cd client
npm run dev
```

å‰ç«¯å°†åœ¨ `http://localhost:5173` å¯åŠ¨ã€‚

### 5. è¿è¡Œæµ‹è¯•

```bash
# æœåŠ¡ç«¯æµ‹è¯•
npm test

# å®¢æˆ·ç«¯æµ‹è¯•
cd client
npm test
```

## å±æ€§æµ‹è¯•

é¡¹ç›®ä½¿ç”¨ fast-check è¿›è¡Œå±æ€§æµ‹è¯•ï¼ŒéªŒè¯ä»¥ä¸‹æ­£ç¡®æ€§å±æ€§ï¼š

- **å±æ€§ 4**: æ¶ˆæ¯å¹¿æ’­æ’é™¤å‘é€è€…
- **å±æ€§ 8**: å¤šç”¨æˆ·è¿æ¥ç‹¬ç«‹ç»´æŠ¤
- **å±æ€§ 10**: ç”¨æˆ·åŠ å…¥å¹¿æ’­é€šçŸ¥
- **å±æ€§ 11**: ç”¨æˆ·ç¦»å¼€å¹¿æ’­é€šçŸ¥
- **å±æ€§ 23**: è¿æ¥å…³é—­æ¸…ç†ä¼šè¯

æ‰€æœ‰å±æ€§æµ‹è¯•è¿è¡Œ 100 æ¬¡è¿­ä»£ä»¥ç¡®ä¿ç³»ç»Ÿæ­£ç¡®æ€§ã€‚

## WebSocket æ¶ˆæ¯åè®®

### LOGIN æ¶ˆæ¯
```json
{
  "type": "LOGIN",
  "userId": "user_123"
}
```

### TEXT æ¶ˆæ¯
```json
{
  "type": "TEXT",
  "id": "uuid-timestamp",
  "senderId": "user_123",
  "content": "Hello, World!",
  "timestamp": 1716283992000
}
```

### SYSTEM æ¶ˆæ¯
```json
{
  "type": "SYSTEM",
  "id": "uuid-timestamp",
  "content": "User_123 joined the chat",
  "timestamp": 1716283992000
}
```

## ğŸ“± Android åº”ç”¨

### å¿«é€Ÿå¼€å§‹

è¯¦ç»†æ­¥éª¤è¯·å‚è€ƒ [android/QUICKSTART.md](android/QUICKSTART.md)

ç®€è¦æ­¥éª¤ï¼š
1. åœ¨ Android Studio ä¸­æ‰“å¼€ `android/` ç›®å½•
2. åŒæ­¥ Gradle ä¾èµ–
3. é…ç½®å¼€å‘æœåŠ¡å™¨ URL
   - çœŸæœºï¼š`http://your-ip:5173`
   - æ¨¡æ‹Ÿå™¨ï¼š`http://10.0.2.2:5173`
4. è¿è¡Œåº”ç”¨

### JSBridge API

Web å±‚å¯é€šè¿‡ `window.AndroidInterface` è°ƒç”¨åŸç”ŸåŠŸèƒ½ï¼š

```javascript
// è·å–è®¾å¤‡ä¿¡æ¯
const deviceInfo = window.AndroidInterface.getDeviceInfo();

// æ˜¾ç¤ºåŸç”Ÿ Toast
window.AndroidInterface.showToast("Hello from Web!");

// é€‰æ‹©æ–‡ä»¶ï¼ˆè¿”å› Base64ï¼‰
const base64Data = window.AndroidInterface.chooseFile("image"); // image/video/audio
```

è¯¦ç»†æ–‡æ¡£ï¼š[android/README.md](android/README.md)

## ğŸ—„ï¸ æ•°æ®åº“è¡¨ç»“æ„ï¼ˆSupabaseï¼‰

```sql
CREATE TABLE messages (
  id TEXT PRIMARY KEY,
  type TEXT NOT NULL,  -- TEXT, IMAGE, VIDEO, AUDIO, SYSTEM
  sender_id TEXT,
  content TEXT NOT NULL,
  timestamp BIGINT NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

å®Œæ•´ SQL è„šæœ¬ï¼š[supabase/schema.sql](supabase/schema.sql)

## ğŸ§ª æµ‹è¯•

é¡¹ç›®ä½¿ç”¨å±æ€§æµ‹è¯•ï¼ˆProperty-Based Testingï¼‰éªŒè¯ç³»ç»Ÿæ­£ç¡®æ€§ï¼š

### æ ¸å¿ƒå±æ€§
- **å±æ€§ 4**: æ¶ˆæ¯å¹¿æ’­æ’é™¤å‘é€è€…
- **å±æ€§ 8**: å¤šç”¨æˆ·è¿æ¥ç‹¬ç«‹ç»´æŠ¤
- **å±æ€§ 10**: ç”¨æˆ·åŠ å…¥å¹¿æ’­é€šçŸ¥
- **å±æ€§ 11**: ç”¨æˆ·ç¦»å¼€å¹¿æ’­é€šçŸ¥
- **å±æ€§ 19**: æ¶ˆæ¯æŒä¹…åŒ–å¾€è¿”ä¸€è‡´æ€§
- **å±æ€§ 20**: å†å²æ¶ˆæ¯æŒ‰æ—¶é—´é¡ºåºè¿”å›
- **å±æ€§ 23**: è¿æ¥å…³é—­æ¸…ç†ä¼šè¯

æ¯ä¸ªå±æ€§æµ‹è¯•è¿è¡Œ 100 æ¬¡è¿­ä»£ä»¥ç¡®ä¿ç³»ç»Ÿæ­£ç¡®æ€§ã€‚

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# è¿è¡Œé›†æˆæµ‹è¯•
npm test -- integration-e2e

# è¿è¡Œå­˜å‚¨æµ‹è¯•
npm test -- storage
```

## ğŸ“š æ–‡æ¡£

- [Supabase é…ç½®æŒ‡å—](SUPABASE_SETUP.md) - äº‘å­˜å‚¨é…ç½®è¯¦ç»†æ­¥éª¤
- [Android å¿«é€Ÿå¼€å§‹](android/QUICKSTART.md) - Android åº”ç”¨è¿è¡ŒæŒ‡å—
- [Android è¯¦ç»†æ–‡æ¡£](android/README.md) - JSBridge å’ŒåŸç”ŸåŠŸèƒ½è¯´æ˜
- [ä»»åŠ¡è®¡åˆ’](.kiro/specs/hybrid-chat-app/tasks.md) - å®Œæ•´å®ç°è®¡åˆ’

## ğŸ¯ ä½¿ç”¨åœºæ™¯

- ä¼ä¸šå†…éƒ¨å³æ—¶é€šè®¯
- åœ¨çº¿å®¢æœç³»ç»Ÿ
- ç¤¾åŒºèŠå¤©å®¤
- æ•™è‚²åŸ¹è®­äº’åŠ¨
- æ¸¸æˆå†…èŠå¤©

## ğŸ”§ ç¯å¢ƒå˜é‡

| å˜é‡ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `PORT` | æœåŠ¡å™¨ç«¯å£ | `8080` |
| `STORAGE_MODE` | å­˜å‚¨æ¨¡å¼ | `file` |
| `SUPABASE_URL` | Supabase é¡¹ç›® URL | - |
| `SUPABASE_ANON_KEY` | Supabase åŒ¿åå¯†é’¥ | - |

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“„ è®¸å¯è¯

MIT License
